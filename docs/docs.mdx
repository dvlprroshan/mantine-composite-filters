import { InstallScript } from './components/InstallScript/InstallScript';
import * as demos from './demos';

## Installation

<InstallScript packages="mantine-composite-filters" />

## Overview

Build powerful filter interfaces in minutes. `CompositeFiltersInput` brings LinkedIn-style composite filtering to your Mantine apps - complete with type-safe definitions, smart operators, presets, and full keyboard support.

**Why use this?**
- Type any field name to start filtering
- Smart operator selection based on data type
- Save filter combinations as reusable presets
- Full keyboard navigation for power users
- Zero configuration localStorage persistence

## Quick Start

<Demo data={demos.usage} />

Three props to get started:

```tsx
<CompositeFiltersInput
  filters={filterDefinitions}  // What fields can be filtered
  value={activeFilters}        // Current filter state
  onChange={setActiveFilters}  // State updater
/>
```

## Interactive Playground

<Demo data={demos.configurator} />

## Filter Types

Seven built-in types cover most filtering needs:

<Demo data={demos.allFilterTypes} />

| Type | Use Case | Default Operators |
|------|----------|-------------------|
| `text` | Names, titles, descriptions | `contains` `starts_with` `ends_with` `=` |
| `email` | Email addresses (with validation) | `contains` `=` |
| `number` | Prices, quantities, scores | `=` `!=` `>` `<` `>=` `<=` |
| `select` | Status, category, single choice | `=` |
| `multi_select` | Tags, roles, multiple choices | `=` |
| `date` | Single date values | `=` `>` `<` `>=` `<=` |
| `date_range` | Date periods, ranges | `between` |

## Limiting Filters

Control complexity with `maxFilters`:

<Demo data={demos.withMaxFilters} />

## Layout Options

Two overflow modes for different UI needs:

<Demo data={demos.overflowModes} />

| Mode | Behavior | Best For |
|------|----------|----------|
| `scroll` | Horizontal scroll, input stays visible | Narrow containers, toolbars |
| `wrap` | Filters wrap to new lines | Wide containers, dashboards |

## Presets & History

Let users save and recall filter combinations:

<Demo data={demos.withPresets} />

Built-in features (all persisted to localStorage):
- **Save presets** - Name and store filter combinations
- **Favorites** - Quick access to frequently used presets
- **History** - Auto-tracked recent filter combinations

## Styling

Make it yours with `styles` or `classNames`:

<Demo data={demos.customStyling} />

### Inline Styles

```tsx
// Direct object
<CompositeFiltersInput
  styles={{
    container: { borderRadius: '12px', borderColor: 'blue' },
  }}
/>

// Theme-aware function
<CompositeFiltersInput
  styles={(theme) => ({
    container: { backgroundColor: theme.colors.gray[0] },
  })}
/>
```

### CSS Classes

```tsx
<CompositeFiltersInput classNames={{ container: 'my-filter' }} />
```

```css
.my-filter { border: 2px solid #228be6; }
.my-filter:focus-within { box-shadow: 0 0 0 2px rgba(34, 139, 230, 0.2); }
```

### Style Targets

| Target | What it styles |
|--------|----------------|
| `root` | Outermost wrapper |
| `container` | Main input box |
| `pillsContainer` | Filter chips area |
| `input` | Text input |
| `rightSection` | Menu button area |
| `dropdown` | Dropdown menus |

## Custom Pills

Replace default filter chips with your own creative designs:

<Demo data={demos.customPills} />

### Gradient Style

```tsx
renderPill={(filter, onRemove) => (
  <Badge
    variant="gradient"
    gradient={{ from: 'violet', to: 'grape' }}
    rightSection={<CloseButton size="xs" onClick={onRemove} />}
  >
    {filter.label}: {filter.displayValue}
  </Badge>
)}
```

### Outlined with Icon

```tsx
renderPill={(filter, onRemove) => (
  <Paper withBorder radius="xl" px="sm" py={4}>
    <Group gap={6}>
      <ThemeIcon size={18} radius="xl" variant="light">
        <IconFilter size={10} />
      </ThemeIcon>
      <Text size="xs">{filter.label}</Text>
      <Text size="xs" c="blue" fw={600}>{filter.displayValue}</Text>
      <CloseButton size="xs" onClick={onRemove} />
    </Group>
  </Paper>
)}
```

### Card Style with Color Accent

```tsx
renderPill={(filter, onRemove) => (
  <Paper 
    shadow="xs" 
    px="sm" 
    py={6}
    style={{ borderLeft: '3px solid var(--mantine-color-blue-5)' }}
  >
    <Text size="xs" c="dimmed">{filter.label}</Text>
    <Text size="sm" fw={600}>{filter.displayValue}</Text>
    <CloseButton size="xs" onClick={onRemove} />
  </Paper>
)}
```

## Keyboard Shortcuts

Power user? Navigate without touching your mouse:

<Demo data={demos.keyboardShortcuts} />

| Shortcut | Action |
|----------|--------|
| `Cmd/Ctrl + /` | Focus filter input |
| `Cmd/Ctrl + Backspace` | Clear all filters |
| `Enter` | Confirm value |
| `Escape` | Cancel input |
| `Backspace` | Remove last filter |

## In Action

See it work with real data filtering:

<Demo data={demos.simpleDataTable} />

## Pro Tips

**Inline Editing** - Click any part of an active filter to edit it directly (field, operator, or value).

**Extend the Menu** - Add your own actions:

```tsx
<CompositeFiltersInput
  customActions={[
    { id: 'export', label: 'Export', onClick: handleExport },
    { id: 'share', label: 'Share Link', onClick: handleShare },
  ]}
/>
```

**Isolate Storage** - Use `storageKeyPrefix` when you have multiple filter instances:

```tsx
<CompositeFiltersInput storageKeyPrefix="users-page" />
<CompositeFiltersInput storageKeyPrefix="orders-page" />
```

## API Reference

### Component Props

| Prop | Type | Default |
|------|------|---------|
| `filters` | `FilterDefinition[]` | required |
| `value` | `ActiveFilter[]` | required |
| `onChange` | `(filters) => void` | required |
| `placeholder` | `string` | `"Filter by..."` |
| `maxFilters` | `number` | unlimited |
| `overflowMode` | `"scroll" \| "wrap"` | `"scroll"` |
| `disablePresets` | `boolean` | `false` |
| `disableHistory` | `boolean` | `false` |
| `storageKeyPrefix` | `string` | `"filters"` |
| `renderPill` | `(filter, onRemove) => ReactNode` | - |
| `customActions` | `FilterAction[]` | `[]` |
| `styles` | `object \| function` | `{}` |
| `classNames` | `object` | `{}` |

### FilterDefinition

```tsx
{
  key: string;           // Unique ID
  label: string;         // Display name
  type: FilterType;      // text | email | number | select | multi_select | date | date_range
  options?: { value: string; label: string }[];  // For select types
  operators?: FilterOperator[];                   // Override defaults
  placeholder?: string;
  icon?: ReactNode;
}
```

### ActiveFilter

```tsx
{
  id: string;            // Auto-generated
  key: string;           // Matches FilterDefinition.key
  label: string;
  type: FilterType;
  operator: FilterOperator;
  value: string | string[] | [Date, Date];
  displayValue: string;  // Formatted for display
}
```

## TypeScript

Fully typed. Import what you need:

```tsx
import type { 
  FilterDefinition, 
  ActiveFilter, 
  FilterType,
  FilterOperator 
} from 'mantine-composite-filters';
```

## Tips

- **Debounce** - For large datasets, debounce the `onChange` before fetching
- **Server validation** - Always validate filter values server-side
- **Mobile UX** - Use `overflowMode="wrap"` on smaller screens
- **Unique keys** - Each filter definition needs a unique `key`
